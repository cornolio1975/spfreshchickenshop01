(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{9645:function(e,t,r){Promise.resolve().then(r.bind(r,8124))},7664:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]])},8124:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(3827),a=r(4090),i=r(7664),c=r(7731),d=r(575),n=r(5671),l=r(2782),o=r(2647),u=r(5887),h=r(4958),x=r(6288);function p(){let[e,t]=(0,a.useState)([]),[r,p]=(0,a.useState)([]),[m,j]=(0,a.useState)(!0),[g,v]=(0,a.useState)(!1),[f,k]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[_,N]=(0,a.useState)(null),[w,S]=(0,a.useState)({product_id:"",new_stock:""}),[C,q]=(0,a.useState)({vendor_id:"",product_id:"",quantity:"",unit_cost:"",remarks:""}),[O,P]=(0,a.useState)({product_id:"",quantity:"",reason:"Damaged",remarks:""}),R=async()=>{j(!0),N(null);let{data:e,error:r}=await h.O.from("products").select("*").order("name");if(r){let e="Product Fetch Error: ".concat(r.message);N(e),x.toast.error(e)}else t(e||[]);let{data:s,error:a}=await h.O.from("vendors").select("id, name").eq("status","Active").order("name");if(a){let e="Vendor Fetch Error: ".concat(a.message);N(e),x.toast.error(e)}else p(s||[]);j(!1)};(0,a.useEffect)(()=>{R()},[]);let z=async t=>{t.preventDefault();let r=Number(C.quantity),s=Number(C.unit_cost),a=r*s;if(!C.vendor_id||!C.product_id||r<=0){x.toast.error("Please fill all required fields");return}try{let{data:t,error:i}=await h.O.from("purchases").insert([{vendor_id:C.vendor_id,total_cost:a,remarks:C.remarks}]).select().single();if(i)throw i;let{error:c}=await h.O.from("purchase_items").insert([{purchase_id:t.id,product_id:C.product_id,quantity:r,unit_cost:s,total_cost:a}]);if(c)throw c;let d=e.find(e=>e.id===C.product_id),n=Number(null==d?void 0:d.stock)||0,{error:l}=await h.O.from("products").update({stock:n+r}).eq("id",C.product_id);if(l)throw l;x.toast.success("Purchase recorded & Stock updated"),v(!1),q({vendor_id:"",product_id:"",quantity:"",unit_cost:"",remarks:""}),R()}catch(t){console.error(t);let e="Purchase Failed: ".concat(t.message||JSON.stringify(t));N(e),x.toast.error(e)}},I=async t=>{t.preventDefault();let r=Number(O.quantity);if(!O.product_id||r<=0){x.toast.error("Please select product and quantity");return}try{let{error:t}=await h.O.from("inventory_adjustments").insert([{product_id:O.product_id,quantity:r,reason:O.reason,remarks:O.remarks}]);if(t)throw t;let s=e.find(e=>e.id===O.product_id),a=Number(null==s?void 0:s.stock)||0,{error:i}=await h.O.from("products").update({stock:a-r}).eq("id",O.product_id);if(i)throw i;x.toast.success("Loss reported & Stock deducted"),k(!1),P({product_id:"",quantity:"",reason:"Damaged",remarks:""}),R()}catch(t){console.error(t);let e="Adjustment Failed: ".concat(t.message||JSON.stringify(t));N(e),x.toast.error(e)}},D=e=>{S({product_id:e.id,new_stock:e.stock?e.stock.toString():"0"}),b(!0)},E=async e=>{e.preventDefault();let t=parseFloat(w.new_stock);if(isNaN(t)){x.toast.error("Invalid stock value");return}try{let{error:e}=await h.O.from("products").update({stock:t}).eq("id",w.product_id);if(e)throw e;x.toast.success("Stock updated directly"),b(!1),R()}catch(t){console.error(t);let e="Update Failed: ".concat(t.message||JSON.stringify(t));N(e),x.toast.error(e)}};return(0,s.jsxs)("div",{className:"space-y-4",children:[_&&(0,s.jsxs)("div",{className:"bg-destructive/15 text-destructive p-4 rounded-md border border-destructive/20 font-bold whitespace-pre-wrap",children:["CRITICAL ERROR: ",_]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Inventory Level"}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)(d.z,{variant:"destructive",onClick:()=>k(!0),children:"Report Loss"}),(0,s.jsxs)(d.z,{onClick:()=>v(!0),children:[(0,s.jsx)(i.Z,{className:"mr-2 h-4 w-4"}),"Record Purchase (Stock In)"]})]})]}),(0,s.jsxs)(n.Zb,{children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{children:"Current Stock"})}),(0,s.jsx)(n.aY,{children:(0,s.jsxs)(u.iA,{children:[(0,s.jsx)(u.xD,{children:(0,s.jsxs)(u.SC,{children:[(0,s.jsx)(u.ss,{children:"Product Name"}),(0,s.jsx)(u.ss,{children:"Unit"}),(0,s.jsx)(u.ss,{children:"Current Stock"}),(0,s.jsx)(u.ss,{children:"Status"}),(0,s.jsx)(u.ss,{className:"text-right",children:"Action"})]})}),(0,s.jsxs)(u.RM,{children:[0===e.length&&!m&&(0,s.jsx)(u.SC,{children:(0,s.jsx)(u.pj,{colSpan:5,className:"text-center py-4 text-muted-foreground",children:"No inventory found."})}),e.map(e=>(0,s.jsxs)(u.SC,{children:[(0,s.jsx)(u.pj,{className:"font-medium",children:e.name}),(0,s.jsx)(u.pj,{children:e.unit_type}),(0,s.jsx)(u.pj,{className:"font-bold text-lg",children:Number(e.stock||0).toFixed(2)}),(0,s.jsx)(u.pj,{children:(0,s.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ".concat((e.stock||0)>10?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:(e.stock||0)>10?"Good":"Low Stock"})}),(0,s.jsx)(u.pj,{className:"text-right",children:(0,s.jsx)(d.z,{variant:"ghost",size:"icon",onClick:()=>D(e),children:(0,s.jsx)(c.Z,{className:"h-4 w-4"})})})]},e.id))]})]})})]}),g&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)(n.Zb,{className:"w-full max-w-lg bg-background shadow-lg",children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{children:"Record New Purchase"})}),(0,s.jsx)(n.aY,{children:(0,s.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Select Vendor"}),(0,s.jsxs)("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:C.vendor_id,onChange:e=>q({...C,vendor_id:e.target.value}),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Vendor..."}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Select Product"}),(0,s.jsxs)("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:C.product_id,onChange:e=>q({...C,product_id:e.target.value}),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Product..."}),e.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.unit_type,")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Quantity (Stock In)"}),(0,s.jsx)(l.I,{type:"number",step:"0.01",value:C.quantity,onChange:e=>q({...C,quantity:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Unit Cost (RM)"}),(0,s.jsx)(l.I,{type:"number",step:"0.01",value:C.unit_cost,onChange:e=>q({...C,unit_cost:e.target.value}),required:!0})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Remarks"}),(0,s.jsx)(l.I,{value:C.remarks,onChange:e=>q({...C,remarks:e.target.value}),placeholder:"Invoice #123..."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(d.z,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),(0,s.jsx)(d.z,{type:"submit",children:"Confirm Purchase"})]})]})})]})}),f&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)(n.Zb,{className:"w-full max-w-lg bg-background shadow-lg",children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{className:"text-destruct",children:"Report Stock Loss"})}),(0,s.jsx)(n.aY,{children:(0,s.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Select Product"}),(0,s.jsxs)("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:O.product_id,onChange:e=>P({...O,product_id:e.target.value}),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Product..."}),e.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (Current: ",Number(e.stock||0).toFixed(2),")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Quantity to Remove"}),(0,s.jsx)(l.I,{type:"number",step:"0.01",value:O.quantity,onChange:e=>P({...O,quantity:e.target.value}),required:!0,placeholder:"e.g. 1"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Reason"}),(0,s.jsxs)("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:O.reason,onChange:e=>P({...O,reason:e.target.value}),children:[(0,s.jsx)("option",{value:"Damaged",children:"Damaged"}),(0,s.jsx)("option",{value:"Dead",children:"Dead (Poultry)"}),(0,s.jsx)("option",{value:"Expired",children:"Expired"}),(0,s.jsx)("option",{value:"Theft",children:"Theft"}),(0,s.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"Remarks"}),(0,s.jsx)(l.I,{value:O.remarks,onChange:e=>P({...O,remarks:e.target.value}),placeholder:"Details..."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(d.z,{type:"button",variant:"outline",onClick:()=>k(!1),children:"Cancel"}),(0,s.jsx)(d.z,{type:"submit",variant:"destructive",children:"Confirm Loss"})]})]})})]})}),y&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)(n.Zb,{className:"w-full max-w-sm bg-background shadow-lg",children:[(0,s.jsx)(n.Ol,{children:(0,s.jsx)(n.ll,{children:"Edit Stock Level"})}),(0,s.jsx)(n.aY,{children:(0,s.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o._,{children:"New Stock Quantity"}),(0,s.jsx)(l.I,{type:"number",step:"0.01",value:w.new_stock,onChange:e=>S({...w,new_stock:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(d.z,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,s.jsx)(d.z,{type:"submit",children:"Update Stock"})]})]})})]})})]})}}},function(e){e.O(0,[150,620,688,288,543,971,69,744],function(){return e(e.s=9645)}),_N_E=e.O()}]);